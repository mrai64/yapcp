# Diario dello sviluppatore, data 27 agosto 2025

Nav: [index](../index.md) : [TDL](../TDL.md) : [log](../../storage/logs/laravel.log)

## Step by step

Domanda: preparo la scheda federazione e poi la sottoscheda sezioni che riassume i codici e i temi che i regolamenti concorsi delle rispettive federazioni prevedono, in questo modo per i bandi di concorso ci sar√† da selezionare i temi previsti in lista o aggiungere a testo libero nella compilazione del bando sulla piattaforma. Poi, √® questa la domanda, come f@ccio aggiungere i temi?  

- Potrei fare una lista di sezioni con il pulsante check a fianco, quelli che scelgo. Contro: a disposizione solo uno per sezione, che per√≤ √® la maggior parte dei concorsi, c'√® un solo Tema libero BN, non ce ne sono due. i temi a piacere avranno un codice progressivo previsto dai regolamenti (come in FIAF).
- Potrei fare una lista delle sezioni nel concorso e una da cui pescare a disposizione, affiancate sx/dx. Per aggiungere servirebbe un trascinamento oppure un pulsante ADD sulla lista delle sezioni disponibili e in caso di errore REM sulla lista delle sezioni gi√† aggiunte.

Le *sezioni - federazioni* si portano dietro anche una lista di verifiche automatiche fattibili sulle opere, banalmente la prima sar√† sul numero di opere presentabili max:4; sulla dimensione in px lato lungo max:2500; sui formati file in:jpg,jpeg,raw; e quello che si pu√≤ controllare. Per le foto simili dovr√≤ trovare come ridimensionare le immagini per confrontarne le miniature, se trovo una libreria php che lo fa altrimenti se fosse in python far√≤ delle API.
Questa lista di funzioni di verifica sar√† a disposizione in una classe dedicata, ipotesi: *ContestValidation* che avr√† la sua funzione-metodo. Le regole avranno una struttura ternaria: { attivo/spento, 'nome_funzione', 'parametro/i' } per cui devo valutare se memorizzarli in un JSON o fare una terna di tabelle nonno-padre-nipote.

/ Nota: Per marcare i caratteri a fine riga in VSC.  
Andare in Code > Impostazioni e fare la ricerca di Render whitespace.  
Al posto dello spazio bianco appare un pallino poco contrastato, ma visibile.  
/ perch√© mettendo due spazi a fine riga si *forza accapo*. Sul mac appare anche un punto, ma basta farlo con un po' di ritardo e non esce.

## Organization\Modify

*Basta ciacoe, taca!*

```php
php artisan livewire:make Organization.Modify
 COMPONENT CREATED  ü§ô

CLASS: app/Livewire/Organization/Modify.php
VIEW:  resources/views/livewire/organization/modify.blade.php
```

PS [LaravelViews](https://laravelviews.com) Griglie di schede.  

Finito **commit**

**NOTA** A differenza del progetto di archiviazione qui non vengono registrate
le modifiche ante e post. Usando il laravel model.live ogni modifica viene aggiornata,
subito, senza fare registro delle modifiche.

## Organization\Remove

Che non si pu√≤ chiamare delete ma comunque remove √® un sinonimo molto valido.
Un altro "poco utile", se un circolo organizzatore cambia denominazione
si aggiorna.

```php
php artisan livewire:make Organization.Remove
 COMPONENT CREATED  ü§ô

CLASS: app/Livewire/Organization/Remove.php
VIEW:  resources/views/livewire/organization/remove.blade.php
```

**Sorpresa** Azzarola!, il record cancellato si vede ancora in lista.
Questo perch√© non uso all() ma una funzione che fa DB::table(...),
quindi la colonna deleted_at deve **entrare nella query** come  
`->whereNull('deleted_at')`  
ed √® tutto.

Funziona a posto, **commit**.

Sostituito il marchio di laravel con quello di yaPCP come x-application-logo. **commit**

## Federation\Section

Una sotto-tabella della tabella Federation √® la Section. Nel Regolamento concorsi di FIAF. Quindi foreign key sul campo country_id ma anche su organization_id. E il factory deve pescare dall'elenco delle Federations.

```php
php artisan make:model Federation/Section

   INFO  Model [app/Models/Federation/Section.php] created successfully.
```

Creata in Models una cartella contenente il modello della tabella figlio.  
All'interno la classe prende giustamente il solo nome di Section, quindi se dovessi,
anzi QUANDO DOVR√í lavorare con federation/section e con il contest/section
sar√† un bel bandolo da sbrogliare?, ma no: si risolve facile, sar√†

```php
use App\Models\Federation\Section as FedSec;
use App\Models\Contest\Section    as ConSec;
```

O quello che user√≤ per distinguerle, e solo l√¨. L'alternativa? Non usare
cartelle ma nomi composti FederationSection ContestSection.  
*Uno √® meglio dell'altro, oppure si va a De gustibus?*

Uno dei punti da risolvere √® che alla create io devo avere gi√† in mano
e passare in palla l'id della organization. Controller e blade?
Una cosa alla volta.

```php
php artisan livewire:make Federation.Section.Listed
 COMPONENT CREATED  ü§ô

CLASS: app/Livewire/Federation/Section/Listed.php
VIEW:  resources/views/livewire/federation/section/listed.blade.php
```

*Ci sono arrivato piano piano con una ventina di tentativi sbagliati, non perch√© andassero male ma perch√© erano su organization (e che c'entra?).*

Per√≤ per la tabella non ci sono sottocartelle,

```php
php artisan make:migration create_federation_sections_table

   INFO  Migration [database/migrations/2025_08_27_144417_create_federation_sections_table.php] created successfully.  
```

```php
php artisan make:migration add_contact_to_federations_table --table=federations

   INFO  Migration [database/migrations/2025_08_27_151410_add_contact_to_federations_table.php] created successfully.  
```

Addata la colonna contact sulle tabelle federations e organizations,
resta TODO aggiungere il campo nei moduli di Add Modify e Remove.
In lista non lo mostro.

- [x] migration
- [ ] Section model
- [ ] Listed component e controller
- [ ] Add component e controller
- [ ] Modify component e controller
- [ ] Remove component e controller

La Remove finora √® stata messa senza verifiche sulle tabelle,
tuttavia sar√† da aggiungere un controllo che quando si va a cancellare
il record sia cancellabile per N motivi, per esempio se ci fosse la cancellazione
di una organization che ha ancora un concorso non concluso √® ovvio
che la cancellazione va bloccata, ma andrebbe bloccata anche
se il concorso fosse chiuso e concluso ma non sia passato per il backup, ovvero
la data di ultimo backup che sar√† un un .backup.env sia inferiore alla data updated_at.

## FederationSection

√à andato tutto bene fino alla funzione di seeder, che non c'√® stato verso
di farla andare bene. Quindi si torna al piano senza cartelle:

```text
üî¥ Federation\Section
üî¥ Federations

üü¢ Federations
üü¢ FederationSections

git revert b459c3dc49acf3eafb90fe26ec94e33a8160b10e
```

E via a rifare daccapo FederationSections

- [ ] `Migration` 
- [ ] `Factory__`

```php
$ php artisan make:migration create_FederationSections_table

   INFO  Migration [database/migrations/2025_08_27_191127_create_federation_sections_table.php] created successfully.  

$ php artisan migrate:status

  Migration name ................................................................................................................. Batch / Status  
  0001_01_01_000000_create_users_table .................................................................................................. [1] Ran  
  0001_01_01_000001_create_cache_table .................................................................................................. [1] Ran  
  0001_01_01_000002_create_jobs_table ................................................................................................... [1] Ran  
  2025_08_23_110724_create_federations_table ............................................................................................ [2] Ran  
  2025_08_25_175307_create_organizations_table .......................................................................................... [2] Ran  
  2025_08_27_151410_add_contact_to_federations_table .................................................................................... [3] Ran  
  2025_08_27_153529_add_contact_to_organizations_table .................................................................................. [3] Ran  
  2025_08_27_154346_add_country_id_to_federations_table ................................................................................. [3] Ran  
  2025_08_27_191127_create_federation_sections_table ..................................................................................... Pending  

  php artisan migrate
  php artisan make:model FederationSection
  ...Edit
  php artisan make:factory FederationSectionFactory
  ...Edit
  php artisan make:seeder FederationSectionSeeder
  ...Edit
  php artisan db:seed --class=FederationSectionSeeder
```

Attenzione: nel primo migration l'iniziale di federation √® **minuscola**,
l'iniziale di Section **maiuscola**, questo crea la tabella federation **underscore**
sections. FederationSection ha due maiuscole, e si ripete cos√¨ nel factory, e
nel seeder. Il seeder al suo interno punta alla tabella federation **underscore**
sections e quindi andiamo a bolla.

L'uso delle cartelle metteva in crisi gli abbinamenti Model - Seeder,
adesso trattandosi di tabella child andrebbe creato un list da inserire
nella scheda singolare del record padre, con dei pulsanti ADD per aggiungere
e dei pulsanti modify / delete su ogni record. Sia Add che Modify che delete
**DOVREBBERO** andare editati in un form MODALE.

Per ora stop qui e **commit**
