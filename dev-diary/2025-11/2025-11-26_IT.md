# Diario dello sviluppatore, data 26 novembre 2025

* [index](../index.md) |
  [To Do List](../TDL.md) da svuotare e migrare in |
  [project](https://github.com/users/mrai64/projects/1) issue list  

* [Route](/routes/web.php)  

* [‚óÄÔ∏è Diario di ieri](./2025-11-25_IT.md)

* <http://yapcp.test/>
* [log](/storage/logs/laravel-2025-11-26.log)  
_

## Pannello dell'organizzazione Vista dei voti per sezione

Il pannello ieri sera √® stato aggiustato inserendo i campi
della nuova query complessa. La query consente di vedere
e mostrare con paginazione l'elenco delle opere per classifica
affiancando la somma dei voti che determina la classifica
con la percentuale (a due decimali) che copre da quel voto
in su. Query che da solo avrei scritto in un paio di ore
e che chiesta all'oracolo mi ha chiesto una mezz'ora tra
capire la risposta se fosse giusta e imparare qualcosa
sulle vecchie select nidificate che ora sono subquery.

Si pu√≤ fare differenza se il dato da estrarre √® uno solo
ed √® indicizzabile, si pu√≤ mettere come ultimo dato nell'indice
ottenendo l'effetto positivo di avere un accesso solo
all'indice per avere il risultato invece di obbligare
il sistema ad inserire (quando manca) in indice la
primary key per poi fare una lettura del record
(ndo sta sta, alla fine son sempre letture in fs
e vanno via millisecondi che √® na bellezza)
per recuperare il dato.

Cambio il campo contest_works.review_required da char(1)
in boolean default false. Questo in db viene convertito con
un tinyint(1) che pu√≤ essere 0==false altrimenti true.
Il campo in mappa √® di "azione", non viene memorizzato
in un archivio da cui pu√≤ essere recuperato ma agisce
a comandare tutti i record della tabella contest_votes
che hanno lo stesso section_id work_id.
Nel componente andr√† gestito un campo a uso interno.

## URGENT REFACTOR

√à la separazione in /contest/build e contest/manage
oppure contest/handle  
per distinguere la creazione del concorso dalla gestione del concorso
come votazioni tabelle e quant'altro
Si pu√≤ anche avere un manage/jury e un manage/organization
oppure tutto quello che riguarda la giuria deve andare sotto /jury

In effetti avevo anche gi√† messo un avviso:
/contest √® per la build del concorso
/organization/contest √® dedicato alla gestione del concorso da parte dell'organizzazione
e quindi /contest/jury deve restare limitato alla definizione dei giurati nel concorso
mentre le azioni dei giurati NEL concorso devo spostarle

devo creare una /Jury/ per le azioni che i giurati fanno sul concorso, spostandole da /contest
e devo modificare anche il path in web.php

* Contest/Jury/Board.php deve andare in Jury/Board.php
* Contest/Jury/Dias.php  deve andare in Jury/SingleDia.php

```sh
‚úÖ php artisan livewire:move --help
Description:
  Move a Livewire component

Usage:
  livewire:move [options] [--] <name> <new-name>

Arguments:
  name                  
  new-name              

  *Name? Che name? Grazie Graziella, chiarissimo...* 

üõë  php artisan livewire:move Contest/Jury/Board.php Jury/SectionBoard.php
üõë  php artisan livewire:move Livewire/Contest/Jury/Board.php LiveWire/Jury/SectionBoard.php
üõë  php artisan livewire:move /app/Livewire/Contest/Jury/Board.php app/LiveWire/Jury/SectionBoard.php
üõë  php artisan livewire:move /app/Livewire/Contest/Jury/Board app/LiveWire/Jury/SectionBoard
‚úÖ  php artisan livewire:move Contest/Jury/Board Jury/SectionBoard
 COMPONENT MOVED  ü§ô

CLASS: app/Livewire/Contest/Jury/Board.php => app/Livewire/Jury/SectionBoard.php
VIEW:  resources/views/livewire/contest/jury/board.blade.php => resources/views/livewire/jury/section-board.blade.php

```

‚ÄºÔ∏è Fatto il trasferimento web.php diventa *automaticamente* errato perch√© il vecchio percorso
√® stato sostituito, serve quindi sostituirlo subito altrimenti i successivi comandi
vengono interrotti per errore. Se il percorso manca in web.php nessun problema,
vanno per√≤ modificate le chiamate @livewire nei file blade.

Alt! non Jury collettivo ma juror singolare il voto √® del giurato

### ¬†Da revisionare

* Juror/SectionBoard   era Contest/Jury/Board
* Juror/Vote           era Contest/Jury/Vote
* Juror/SingleDia      era Contest/Jury/Dias
* Juror/ReVote         era Contest/Jury/ReVote
* Juror/ReviewVote     era Contest/Jury/VoteMod
* Juror/SingleVotedDia era Contest/Jury/Voteddias
* Jury/SectionBoard    era Contest/Section/Voteboard

e non sono tutti.

Per il collaudo devo passare come giurato del concorso  
section_id > contest_jury > contest_jury.user_contact_id === Auth.id();

Ho fatto una verifica con Gate e Policy per il pagamento delle iscrizioni,
qui c'√® da riprender eil concetto. Possono accedere ai pannelli
delle giurie i giurati del concorso. Parametro globale: Auth::id(),
altro parametro: string section_id

funzione di verifica con output classe Response, 
in alternativa: Response::allow() e Response::deny(messaggio)

Vedi diario dell'[11 ottobre](/dev-diary/2025-10/2025-10-11_IT.md), i nomi come al solito
sono importanti: il controllo che i pannelli siano accessibili posso battezzarlo
JurorOnlyPolicy intendendo che il pannello √® riservato ai giurati.

Ma dove vado a prendere il giurato √® una domanda lecita, in quanto lo
user_roles.role comprende 'juror' ed √® autoassegnabile mentre 
contest_jury.user_contact_id viene assegnato dall'organizzazione
e non √® autoassegnabile, sembra quindi scontato che passi per la verifica in
tabella contest_juries.

```php
php artisan make:policy JurorOnlyPolicy

   INFO  Policy [app/Policies/JurorOnlyPolicy.php] created successfully.  
```

Aggiornato AppServiceProvider, il controllo si pu√≤ mettere sia nei controller
che nella blade per impedire l'acceso ai controller.
Vanno messi entrambi perch√© il link si pu√≤ copincollare.

Alla stessa maniera posso inserire un gate per le pagine cui deve
accedere qualcuno dell'organizzazione, in questo caso s√¨,
serve solo user_roles.

```php
$ php artisan make:policy OrganizationMemberOnlyPolicy

   INFO  Policy [app/Policies/OrganizationMemberOnlyPolicy.php] created successfully.  
```
