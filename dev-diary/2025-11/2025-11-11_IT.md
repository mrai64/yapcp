# Diario dello sviluppatore, data 11 novembre 2025

* [index](../index.md)
* [TDL](../TDL.md)
* [project](https://github.com/users/mrai64/projects/1)
_
* [Route](/routes/web.php)
_
* [◀️ ieri](./2025-11-10_IT.md)
* [log](/storage/logs/laravel.log)
bbedit ./storage/logs/laravel.log

## Paginazione quasi risolta

Serve integrare la query con tutti i dati che prima erano previsti tramite
le relationship. Il ragionamento è che in una strada si possono avere
delle concatenazioni eleganti da mettere gù. Dall'altra delle prestazioni
che non ammettono sconti, anzi possono solo che peggiorare.
DB:RAW mette giù parti di codice che non vengono trattate.
Volendo integrare i dati di Work con i dati di UserContact, come la cambio
la query?

Chiesto ieri chiedo oggi, vai di gemini.google.com 

Come si...? *Query che pesca dati da 2 tabelle works e user_contacts*  
Devo usare il Model::query(), ci sono due modi, si fa accesso a una tabella
con il Model, passando poi una join() e una whereIN()

I dati che c'erano e vorrei ci fossero

```sql
bind :section_id

SELECT pcp_works.*, pcp_user_contacts.country_id, pcp_user_contacts.last_name,
pcp_user_contacts.first_name
FROM pcp_user_contacts, pcp_works, pcp_contest_works

WHERE pcp_works.user_id = pcp_user_contacts.user_id
  AND pcp_works.id      = pcp_contest_works.work_id
  AND (pcp_contest_works.section_id = :section_id)
```

```php
// Assumendo che tu abbia un modello PcpWork
$sectionId = $request->input('section_id'); // Usa il valore corretto

$results = Work::select([
        'works.*',
        'user_contacts.country_id',
        'user_contacts.last_name',
        'user_contacts.first_name'
    ])
    // JOIN con user_contacts
    ->join('user_contacts', 'works.user_id', '=', 'user_contacts.user_id')
    // JOIN con contest_works
    ->join('contest_works', 'works.id', '=', 'contest_works.work_id')
    // CLAUSOLA WHERE per section_id
    ->where('contest_works.section_id', $sectionId)
    ->get();

```

Resta il punto di chi fa cosa: se la pagina serve a filtrare le immagini prima di passarle alla giuria
non devo vedere l'elenco di tutte le foto partecipanti, che è quanto sopra, ma devo
predisporre una lista di work_id "già giudicati" ed escluderla
dalla vista fino a quando non ne restano zero.

