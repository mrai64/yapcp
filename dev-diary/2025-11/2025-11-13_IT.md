# Diario dello sviluppatore, data 13 novembre 2025

* [index](../index.md)
* [TDL](../TDL.md)
* [project](https://github.com/users/mrai64/projects/1)
_
* [Route](/routes/web.php)
_
* [◀️ ieri](./2025-11-12_IT.md)
* [log](/storage/logs/laravel.log)
* [MAMP base ↗️](http://127.0.0.1:8888/yapcp/public/)
_ [MAMP mysql ↗️](http://localhost:8888/phpMyAdmin5/index.php?route=/database/structure&db=pcpdb)
  bbedit ./storage/logs/laravel.log

## Lista delle tabelle e dei loro ruoli

Preparata una prima lista delle tabelle e dei loro ruoli, però è un lavoro incompleto.
Volevo mettere in md le definizioni delle tabelle e le relazioni
Parto dalla descrizione della tabella che di fatto dovrebbe essere a sua
volta una tabella, un foglio excel in cui elenco la tabella, la sequenza, i campi e
(finiti i campi) elenco gli indici.

Mi è venuta l'insana idea di revisionare il codice per chiarire
dove Work è lo UserWork e dove è ContestWork, ogni volta che
vedo Work mi parte i riflesso pavloviano che si deve chiamare UserWork.

Altra insana idea è revisionare il codice per inserire nei Model i legami
e per aggiungere dove mancano i legami in mysql is foreign key of.

Che poi dove non posso usare i traversamenti dovrei creare delle
static function che forniscano l dato e infilare le funzioni
nelle blade.

## I VOTI

```php
$ php artisan make:seeder ContestVoteSeeder

   INFO  Seeder [database/seeders/ContestVoteSeeder.php] created successfully.  
```

Cosa metterci dentro

* Prendere un concorso
  * per ogni sezione del concorso
    * per ogni lavoro iscritto alla sezione del concorso
      * per ogni giurato della sezione del concorso
        * D.: verifica se esiste già un voto
        * R.: esiste  
        Passa al prossimo
        * R.: non esiste  
          * Somma 6 volte un random tra 4 e 6  
            se supera il max metti il max  
            inserisci il voto

A questo punto faccio un seeder che spazzola tutto e dove manca un voto lo aggiunge
un po' di *echo* per tenere traccia del lavoro in corso e via lascio andare. 

Intanto preparo una view per i voti 

```sql
SELECT 
	count(*),
  c.name_en as 'contest_name',
  cs.name_en as 'section_name',
  cv.vote,
	cv.contest_id,
  cv.section_id
FROM 
  `pcp_contest_votes` cv, 
  pcp_contests c, 
  pcp_contest_sections cs 
where c.id = cv.contest_id 
  and cs.id = cv.section_id
group by 
	cv.contest_id,
  cv.section_id,
  cv.vote
order by 
  5,
  6,
  4 DESC
```

C'è una distribuzione tra i 15 e i 30. Troppi 30, rivedo il bilancino delle rand(),
svuoto tutto e riparto da vuoto. Vanno via 4 voti / secondo ma fa. 



## tabelle ausiliarie, a better way?

A vederla "alla laravel" serve sempre mettere id come colonna pk, 
quindi *contests.vote_rule* che si interfaccia con *contest_vote_rule_sets.vote_rule*  
dovrebbe diventare *contest_vote_rule_id* fk *contest_vote_rules.id*.  

countries / country_id è già a posto,  
contest_participants_fee_payment_completed_sets andrebbe cambiato in fee_payment_completeds
con fk fee_payment_completeds.id puntato da contest_participants.fee_payments_completed_id

Contest_sections.federation_sections_id è già a posto, puntando a federation_sections.id
contest_sections.under_patronage potrebbe diventare under_patronage_id puntando alla
tabella ausiliaria under_patronages.id 
contest_sections.rule_monochromatic potrebbe puntare a rule_monochromatic.id
contest_sections.rule_format che definisce le estensioni previste non è una foreign key,
andrebbe aggiunta la rule_raw_required con rule_raw_requireds.id 
Alla tabella andrebbe associata una tabella child in cui siano caricate come raw_work.id
correlate al contest_works.id via raw_works.contest_work_id o raw_works.user_work_id con la tabella
user_works / attualmente works solo.
