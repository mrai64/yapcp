# Diario dello sviluppatore, data 12 settembre 2025

Nav: [index](../index.md) : [TDL](../TDL.md) : [log](../../storage/logs/laravel.log)

## Mandare una mail post-login

Si può mettere una funzione prima del redirect della login, certo.
Ma imparare costa. Laravel "attiva eventi", e la programmazione ad eventi
funziona come un centralino: se il telefono squilla e non risponde nessuno
non succede niente, ma se qualcuno c'è che risponde, si fa qualcosa.

### Come riceve i dati un centralinista?

* Serve la cartella che non c'è nella versione base.  
`php artisan make:listener`  
Vengono gestiti [eventi](https://laravel.com/docs/12.x/events)
* Si può avere anche una cartella di email pronte a spedire
e anche questa funzione non è di fabbrica, serve fare  
`php artisan make:mail`, poi lì dentro andranno piazzate le mail che l'app spedisce.
Eventi e ascoltatori vanno considerati mentalmente degli
effetti collaterali. Ci son lavori che la macchina fa
e mentre fa devi stare lì ad aspettare che finisca, altri
che possono andare per conto loro, e non devi aspettare che finiscano.

### Rules

Tra le cartelle che si possono usare per gestire cose
c'è anche una cartella Rules, in cui si può piazzare
le classi che centralizzano i controlli specializzati,
per esempio quella sul calendario delle date.

## Notifiche

Quello che sto cercando in effetti c'è già, quando uno si collega
voglio notificargli che si è collegato.
[Notifiche](https://laravel.com/docs/12.x/notifications#introduction)
Le notifiche in laravel possono andare via e-mail
ma anche via sms, e altri canali aggiunti dalla community. Si possono mettere notifiche in tutti i modelli, non solo quello più ovvio degli users.  
C'è l modo di mandare una e di mandare molte notifiche,
che è lo stesso che mandare una notifica a un sacco di persone.  
Mandare un sacco di notifiche richiede tempo e quindi
anche questo coinvolge le Code.

Classe Model Fattura  
Classe Notification FatturaPagare  
i dati di FatturaPagare saranno passati in
una istanza contenente quello che serve.
Classe MailMessage ->toMail()

Ripartendo dal foglio bianco

Succede che *utente* fa il **login**, usando la sua *email* come chiave d'accesso; va bene, non va bene, parte una **notifica** il cui scopo è mandare una **email** all'indirizzo di posta che segnala l'accesso
effettuato.

1. Nel Model Users aggiunge Notificabile
1. php artisan aggiungere cartella notifiche
1. php artisan se manca aggiungere cartella mail
1. in cartella notifiche classe AccessoEseguito
1. in cartella mail Mail AccessoEseguito, se non hai fatto te bla bla
1. andare nel controller del login e inserire la riga di richiamo notification accesso eseguito.  
Input della notifica?  
Quando avviene il login i dati a disposizione sono quelli di Users e di auth. Alla classe notification AccessoEseguito passo l'istanza di Users.
1. A sua volta la notifica deve dire che si spedisce la mail, la mail deve avere in linea i dati di Accesso Eseguito che sono i dati di user con indirizzo email nome e cognome. Da inserire come campi nella mail.
