# Diario dello sviluppatore, data 18 ottobre 2025

* [index](../index.md)

* [TDL](../TDL.md)
* [project](https://github.com/users/mrai64/projects/1)
* [◀️ ieri](./2025-10-17_IT.md)
* [log](/storage/logs/laravel.log)

## Ancora Relazioni

Tabelle padri tabelle figlio, se la tabella padre hasOne() hasMany(),
la tabella figlio belongsTo(). Questo per consentire di leggere i dati
senza scrivere una semplice query ma a patto di avere sempre
dei campi id e tabella_id.

## Caricamenti e scaricamenti

Caricamento concorsi, sto pensando di creare una scheda
in formato yaml, quindi leggibile sia dall'umano che
dalla piattaforma e che sia scansionata e caricata
nelle varie tabelle.
La scheda in effetti la immagino articolata, ma non complessa.

```yaml
# Questo viene ignorato dal computer e quindi
# può contenere suggerimenti, indicazioni
# dopo il cancelletto è ignorato tutto fino a fine riga
Persone:
  # Il rientro di 2 caratteri è importante e indica
  # che la cosa è collegata alla cosa superiore
  - email: ...
    # viene chiesta per prima la email perché permette di
    # distinguere tra persone omonime
    Paese: ... # la sigla di 3 lettere in uso alle olimpiadi ITA italia USA, AUS, ecc.
    Cognome: ...
    Nome: ...
  - email: ...
    Paese: ...
    Cognome: ...
    Nome: ...
Circolo:
  email: ...
  Nome: ...
  Paese: ...
  Ruoli:
    - Presidente:
      email: ...
    - Segretario:
      email: ...
Concorso:
  Paese: ...
  Nome: ...
  Organizzato da: ...
    # Il nome del circolo organizzatore deve corrispondere a uno dei
    #   circoli già inseriti
  Calendario:
    data apertura concorso: ... # aaaa-mm-gg
    data chiusura concorso: ...
    data lavori giuria inizio: ...
Temi e sezioni:
  - sezione: sigla
    nome: ...
  - sezione: sigla
    nome: ...
  Giurie:
  - sezione: sigla
    - email:
      paese: ...
      cognome: ...
      nome: ...
    - email:
      paese: ...
      cognome: ...
      nome: ...
Premi:
  - premio:
    nome: ...
  - premio:
    nome: ...
  - premio:
    nome: ...
    sigla sezione: ...
  - premio:
    nome: ...
    sigla sezione: ...
  - altro:
  # Si possono mettere sotto 'altro' i premi che
  # non contano per le statistiche e onorificenze
    nome: ...
    sigla sezione: ...
# > a capo serve a fare un testo lungo ignorando
# gli a capo tra una riga e l'altra
Quote: >
  per 1 o 2 sezioni € xx, sconti per gruppi

```

### Promemoria

* Serve dare in pasto il file yaml a una variabile,  
dare il testo a un convertitore *yaml_to_json*, vedi [yaml_parse_file](https://www.php.net/manual/en/function.yaml-parse-file.php)  
quindi spazzolare la struttura ottenuta per inserire i record o
aggiornarli.  
Facile no, ma *Sii-puòo-faa-ree!* (cit)  
[vedi issue 36](https://github.com/mrai64/yapcp/issues/36)  

* Sono da gestire le appartenenze anche dei concorrenti a gruppi,
ovvero se il concorso è organizzato dal circolo A,
e mario rossi è membro del circolo A può vedere e gestire ma non
partecipare al concorso.
* lo stesso si allarga ai circuiti in cui ogni membro di ogni
circolo non può iscriversi, valutare se un circolo può modificare
tutti i concorsi in circuito. [issue 37](https://github.com/mrai64/yapcp/issues/37)  
* Caricare persone organizzazione ✅  
  Questo si intende solo come inserimento delle persone
* Caricare organizzazione ✅  
  Questo si intende come inserimento solo dell'organizzazione
* Caricare persone in ruolo all'organizzazione  
  Questo comporta l'inserimento di user_roles
* caricare concorso
  * principale
  * calendario
  * sezioni
  * giurie
  * premi
* caricare concorrenti e foto dei concorrenti
  * Serve inserire le persone
  * serve inserire le foto delle persone
  * serve inserire le foto nelle sezioni del concorso
  * lista dei partecipanti al concorso (contatori foto)
  * lista delle opere partecipanti al concorso (no foto)
* serve consentire ai giurati di vedere le foto partecipanti
* serve consentire agli organizzatori di vedere le foto dei partecipanti
  * serve consentire agli organizzatori di escludere foto partecipanti per motivi giustificati e non rilevabili automaticamente (marchi, firme)


### Una questione di regole

Ho sbagliato a creare la tabella ausiliaria, quella dei ruoli.  
Deve correlarsi al campo role della tabella user_roles,
deve chiamarsi user_role_role_sets. Decido che il campo id
lo lascio standard, invece di caricare un tipo stringa.
Sarebbe "giusto" chiamarlo id e di tipo stringa come gli uuid,
ma poi non posso usare foreignId.  
Potrei solo rinominare,... Facciamo tutto in ordine
Sì, rinomino la tabella sbagliata per distringuerla.  
Elimino anche il legame a manina.  

* creato migration
* creato model
* creato factory
* creato seeder
* aggiustato factory per l'unico campo role
* creato seeder per il caricamento dei 6 ruoli 6
* creato collegamento con tabella user_roles
* Cambiato nome della tabella dove c'era (un paio di Validate)

Intanto continuo a rimuginare come caricare qualche centinaio di
concorrenti (users, user_contact),
caricare loro qualche decina di foto a testa (works)
per poi caricare un concorso a mano
e caricare le foto in concorso

**Perché è li che sono fermo a girare in rotonda**
