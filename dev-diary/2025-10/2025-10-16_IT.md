iì# Diario dello sviluppatore, data 16 ottobre 2025

* [index](../index.md)

* [TDL](../TDL.md)
* [project](https://github.com/users/mrai64/projects/1)
* [◀️ ieri](./2025-10-15_IT.md)
* [log](/storage/logs/laravel.log)

## Ancora next step

L'insoddisfazione viene dalle scorciatoie che sembra siano
predisposte in laravel e che non sto usando, motivo per cui
devo usare get()[0] e altri "convertitori". Anche i tutorial
sembra presentino paginazioni che sono predisposte già
in laravel e che non ho ancora imparato.

Sul lato dei test domani il concorso che adesso
è caricato sarà "chiuso", ovvero non dovrà essere possibile
partecipare.
Questo comporta l'esclusione dai concorsi in lista, e questo
so che già funziona, ma qualora ci fosse in cronologia
del browser il link per andare a caricare i lavori
deve partire un test dentro mount() che faccia redirect
alla pagina dei concorsi con un avviso "concorso chiuso".

Serve inserire un nuovo concorso, ✅ caricare nuovi utenti (fatto),
serve caricare opere la qualsiasi agli autori (creare anche
le miniature 300px quando viene caricata l'immagine).

###  federation_id (int) > (char(10)) sostituisce federation_code

È una attività che nella manutenzione e revisione di un progetto può
capitare, anzi può essere "il pane quotidiano" e sto qui per imparare.

Fatti: federation_id è per la tabella federations primary key in
standard laravel ovvero: bigint con autoincrement,
ma di fatto il campo `code`, indicizzato unique, è quello che fa da riferimento
e viene esposto e viene cercato, quindi ci sono dei passaggi
da codice a int da int a tabella collegata. federation_id deve diventare
la colonna code e quindi pk di tipo string e non incrementale, come si fa per gli uuid.

FederationSection è la tabella foglia e si deve sostituire federation_id int
con federation_id char(). Un branch dedicato? sì, tuttavia servirebbe anche
un db dedicato, quindi una scheda env in cui il db non è pcpdb ma pcpbranch.  
C'è da considerare che .env può far parte di gitignore e quindi non essere
"un file del branch", la questione è da verificare.

`Models\Federation;` viene usato in 12 file, la modifica andrebbe
riverberata in 12 punti.
`Models\FederationSection`viene usato in 6 file, compreso factory e seeder.
`Models\Contest\Sections` eredita dati da Federation\Section. Ma sarebbe già a posto così,
se la sezione vale per le statistiche delle federazioni si uno uno dei codici sezione
di una delle federazioni che li prevedono. Non c'è alternativa, se una sezione la FIAP
la chiama Monochromatic e la FIAF la chiama Bianconero, le definizioni
*devono* sovrapporsi anche nell'interesse di FIAF che è affiliata a FIAP.

1. Cambiare il migration di _federations_table e di federation_sections_table.  
Nel caso si cancellano quelli vecchi e se ne creano due di nuovi.

    1. federations.federation_id diventa char(10) non incrementabile
    1. federation_section.federation_id idem char(10)
1. Va creato un factory nuovo per federations
1. Va creato un factory nuovo per federation_sections
1. Si crea un FederationSeeder con dati reali
1. si crea un FederationSectionSeeder con dati reali
1. Si cercano i punti in uso dei federations.code
da sostituire con federations.id e con federation_sections.federation_id
1. Si fa il cambio e si testano le funzioni

Si possono anche creare tabelle parallele feds e fed_secs, le si riempie
e poi si fa la cancellazione di quelle vecchie e la rinomina di quelle nuove
con i nomi vecchi.

Decido di seguire questa strada che è percorribile anche in un ambiente di produzione
limitando il fermo e una sostituzione di tabelle e a un pull request.

La definizione della tabella fed_secs la faccio insieme a quella della tabella feds.
Proprio per la relazione padre figlio che hanno. 2 Models e 1 migration.

1. ✅ Fatto migration di feds e fed_secs
1. ✅ Il migration rinomina le tabelle vecchie e crea quelle nuove (solo una volta)
1. ✅ Ricostruito FederationFactory, FederationSeeder, eseguito FederationSeeder per caricamento
1. ✅ Ricostruito FederationSectionFactory, FederationSectionSeeder e caricate le sezioni FIAF

Verifica blade che espongono dati di Federation e FederationSection  

Ricostruzione Federation Model  

Verifica che federation_id è in uso da:

* [user_roles](/database/migrations/2025_09_19_170924_create_user_roles_table.php)  
  e va cambiato, attualmente è un foreignUuid() char(36)  
  * va cambiato anche il contenuto 5 > FIAF, 6 > UIF, ecc vedi backup
* [user_roles_view](/database/migrations/2025_10_12_133101_create_user_roles_views_table.php)  
va eliminata e ricreata perché ha il nome campo 'name' che non esiste più.
Zot e creazione

Ma sai che alla fine sembra sia stato più facile del previsto?
Certo in produzione sarebbe stato un collasso, vedere che user_roles
non rea nemmeno previsto nelle modifiche. Però,... Adesso c'è un modello più "laravello".

Funziona **commit**

E ti pareva, cosa avevo dimenticato? i moduli per inserire e modificare
i record delle federations.
RIFATTI **commit**
 
e i moduli per la gestione delle sections ...

RIFATTO quello di add 

----

## **LEZIONE DEL GIORNO**

Faccio presto a dire è finita, cambiare i tracciati delle tabelle si porta
**OVVIAMENTE** dietro la modifica delle blade di list, add, modify e delete.
Tutto il CRUD come minimo va riscritto quasi da zero.

in più per la modify devo avere 2 campi per fare chiave,
e trovare il modo di passarli entrambi alle blade.
si fa una stringa con `?key=value&key=value` ?

