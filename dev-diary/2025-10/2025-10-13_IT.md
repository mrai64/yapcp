# Diario dello sviluppatore, data 13 ottobre 2025

* [index](../index.md)
* [TDL](../TDL.md)
* [project](https://github.com/users/mrai64/projects/1)
* [◀️ ieri](./2025-10-12_IT.md)
* [log](/storage/logs/laravel.log)

## Complicazioni

Occorre puntare a un codice più semplice, nei tutorial non
sono utilizzati `->get()[0]` e quindi deve esserci anche un sistema più
elegante e facile di gestire i dati che viaggiano per
l'aggiornamento dei dati. Anche i tempi di risposta credo ne risentano,
sono in un localhost e ho dei tempi di risposta di parecchi secondi.

Una delle basi di laravel sembra sia la scomposizione, per fare
una cosa semplice servono una mezza dozzina di cose incasellate
al loro posto, niente si fa senza un legame che non sia `use (...)`.

Spesso si passa una intera istanza, e non so se sia un bene
o se prenda in carico più spazio memoria per gestirla.
Per esempio la lista partecipanti, posso avere nel model
solo la lettura della lista e nel blade usare dei componenti che
poi ciascuno si va a pescare il nome, il cognome, la bandiera del paese,
ecc.  
Oppure posso avere la lettura della lista, caricarmi la lista
dei partecipanti e passare tutti gli elementi al blade che li espone
avendoli già caricati.  
Sono due approcci diversi e non ho elementi in mano per preferire uno
o l'altro.

## Relazioni (tra tabelle)

Riprendo l'argomento [Eloquent Relationship](https://laravel.com/docs/12.x/eloquent-relationships)
e trovo un esempio in [vedi tutorial](https://youtu.be/NU1-NUM0LYs?si=YelIpy8g-HEK3e6y)

In questo tutorial la tabella users e la tabella profile hanno una relazione 1:1 come è per "le mie" users e user_contacts

1. Viene definita la relazione nel migration con una colonna foreignXXXX
(che può essere foreignId | foreignUuid)
1. tenere presente che la tabella users "padre",  
la tabella Profile "figlio" anche se sono 1:1
1. Viene messo nella classe User (padre) un getter `profile()` per tirare fuori i dati dalla classe Profile con `hasOne(Profile::class)`
1. Si può mettere nella classe Profile un getter `user()` per tirare fuori i dati della classe genitore con `belongsTo(User::class)`

Risultato: si può accedere ai dati della tabella Profile dalla classe User
con un elegante user->profile()->datidellaclasseProfile.

C'è poi da "normalizzare" il rapporto di allineamento da forzare per il campo
user->email vs. user_contacts->email. Posso anche "passare da user" per
avere il campo ma ... saperlo.

Per le relazioni 1:N non ci sarà solo 1 record nella collection di ritorno,
l'esempio è per i post e le categorie dei post.
N record Post hanno 1 record POst_category

* Si vogliono leggere tutti i post che hanno una categoria  
`posts(PostCategory $post_category){`  
`  return $post_category->posts;`  
`}`  

Nel model PostCategory  
hasMany al posto di hasOne

Nel model Post  
ancora belognsTo()

Nel "mio la relazione 1:N  
c'è tra user e works  
c'è tra organization e contest  
c'è tra user e contest_juror  

----

Quindi, come applicare la relazione 1:1: tra users e user_contacts?

* Nel model Users posso aggiungere la public function contact() per leggere i dati
* serve però creare un trigger che quando si crea uno User venga creato anche uno User_contact correlato

Intanto no mi fa modificare la colonna foreignUuid perché dice che esiste già,
Passo a creare una tabella user_profile per fare la creazione della colonna foreingUuid, contrained.
In phpMyAdmin la relazione c'è, pure stretta. On update restrict on delete restrict.  
Creo a mano il legame on phpmyadmin, ora il dubbio è se vale la pena passare del tempo
a riformattare le tabelle e ricaricare dei dati coerenti.
Posso però creare una tabella di travaso in cui caricare i dati presenti adesso,
cancellare e ricreare solo la tabella user_contacts, e riversare al contrario i dati
che son nella tabella di travaso che poi si elimina. Robetta da DBAdmin.

Nel caso invece volessi fare un migrate:refresh devo anche prevedere
il caricamento con `db:seed` di:

* tutte le country
* tutte le federation
* tutte le federation_section con le loro (basiche) regole
* almeno una cinquantina di utenti come concorrenti
* almeno una mezza dozzina di organization
* almeno tre admin e tre superadmin
* associare all'organization almeno una dozzina di utenti
* almeno tre concorsi
  * le sezioni dei concorsi
  * le giurie delle sezioni dei concorsi
  * i premi dei concorsi
* almeno una decina di immagini di diverse dimensioni per ogni utente
* iscrivere una decina di concorrenti per concorso
  * caricare almeno 3 immagini per ogni sezione del concorso

Proprio una passeggiata, 80 giorni per fare un giro intorno al mondo.  
Forse è il caso che riprenda a fare pagine

* persona si registra
  * viene creata una scheda anagrafica vuota
* persona aggiorna la propria scheda anagrafica
* persona inserisce o aggiorna il proprio ruolo in una federazione
* persona inserisce o aggiorna il proprio ruolo in una organizzazione
* organizzazione per tramite di persona crea il concorso
* persona quale concorrente iscrive i propri lavoro al concorso

Fin qua, fatti

----

Da fare:

* *persona quale concorrente iscrive i propri lavoro al concorso*
  * se manca nella lista dei partecipanti viene aggiunto
* prospetto analitico del concorso
  * scheda formato yaml import/export
* prospetto persone partecipanti
  * assegnazione persone a gruppi ev. premio per gruppo più numeroso
* va definito in concorso il metodo di votazione
  * classifica per votazione numerica
    *(modalità che coinvolge numeri e/o simboli di valore scalare)*
  * classifica per eliminatorie
    *(modalità nella quale partendo da un lotto di 4 immagini ne resta solo una che passa al turno successivo fin alla finale)*
* giurato si collega solo nel periodo previsto
  * giurato visiona le immagini
  * giurato assegna i voti
* tavola riassuntiva delle votazioni
  * assegnazione delle ammissioni
  * assegnazione dei premi ad personam es. Miglior Autore, Blue Ribbon fIAP
  * assegnazione dei premi alle opere es. miglior ritratto
  * assegnazione delle HM Menzioni d'Onore
* stesura della bozza di verbale da approvare
  * registrazione verbale
* consegna elenchi per cataloghi e cerimonia di premiazione
  * consegna immagini nominative uso catalogo
* predisposizione sito partecipanti ammessi e opere
* operazioni di backup e pulizia archivi

Direi che lavoro non ne manca