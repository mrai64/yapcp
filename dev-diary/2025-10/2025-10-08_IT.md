# Diario dello sviluppatore, data 8 ottobre 2025

* [index](../index.md)
* [TDL](../TDL.md)
* [project](https://github.com/users/mrai64/projects/1)
* [◀️ ieri](./2025-10-07_IT.md)
* [log](/storage/logs/laravel.log)

## Prossimo step

### Verifiche su immagini partecipanti a concorso

Ieri fatto dei progressi ma buttato tutto, vicolo cieco.

* Creata la Rule per il test su section e work
* Creato un sistema basato sulla session() per memorizzare i dati
  della section_id selezionata e confrontarli con i dati
  del work_id in iscrizione.
* Al momento di fare il messaggio di errore però pretendo di
  posizionarlo il campo "fuori form" della long side del work
  e questo non riesce perché dentro validate non gestisco
  l'assegnazione del messaggio error.

Stamattina avrei altre priorità. però ho deciso che il messaggio di errore va sotto al pulsante di ADD, semplificando.

* Soluzione 1: portare nel form di selezione sezione tutti i dati
  del work in modo da avere regole già scritte con i campi, resta
  il dubbio di come portare tutti i campi della section nel form
  quando si aggiorna il valore della select section_code.
* Soluzione 2: riprendere la validazione con buffer su session.  
  Il primo da validare viene "messo da parte" con session() e al secondo
  da session() si riprendono i dati perché la validazione valida solo un campo
  alla volta e solo quello ha in linea.

Fatto funziona **commit**

### REFACTOR

La tabella contest_participants va rinominata contest_works,
e contenere le opere partecipanti al concorso. La tabella
contest_participants deve contenere user partecipanti al concorso,
anche se può essere una VIEW della tabella contest_works
estraendo solo contest_id, section_id, users_id.

### LE VISTE VISTE e LE VISTE MYSQL

In Laravel le View sono parti di html che si possono popolare di dati
e questo rientra nell'architettura model view controller.
In SQL le viste sono delle query fisse che vengono eseguite
in automatico per creare delle tabelle di dati a sola lettura.

[Vedi anche](https://blog.thms.uk/2024/07/mysql-views-laravel)

### Validazioni manuali

Alcune validazioni andranno effettuate manualmente, serve quindi
dare competenza agli user della Organization perché vedano
le opere in concorso e appongano dei bollini di verifica fatta.
Serve anche registrare le validazioni validatore:users_id, lavoro_id, regola_id e semaforo Y/N.

### Elenco dei ruoli concorso

Cerco di riformulare la select per avere solo una voce per i giurati
che risultano "multipli". Sulla lista dei ruoli degli utenti.

```sql
SELECT
    p.name AS juror_name,
    s.code AS section_code,
    s.name_en AS section_name,
    c.name_en AS contest_name
FROM
    `pcp_contest_juries` j,
    `pcp_users` p,
    `pcp_contest_sections` s,
    `pcp_contests` c
WHERE
    j.section_id = s.id AND s.contest_id = c.id AND j.user_contact_id = p.id
ORDER BY
    4,
    2,
    1
```

Questa da l'elenco dei giurati, e fintanto che c'è differenza tra users
e user_contacts si possono agganciare pochi dati.  
Order by 4,1,2 mette prima i giurati e poi le sezioni.  
