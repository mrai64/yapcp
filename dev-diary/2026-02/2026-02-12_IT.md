# 12/02/2026

[⏪ ieri](./2026-02-11_IT.md) | [index](../index.md) | [domani ⏩](./2026-02-13_IT.md)  
[Docs](/resources/docs/1.0/overview.md)

## Refactor

Confortato da Gemini che gli elementi contruiti con make:model ... -a
non vanno a bloccare il progetto, li mando su anche se "di default".

Come ho creato la Casts per Country3Id per il country code iso-3166 alpha-3
posso creare un Casts per ResponseYN per convertire il true/false
in Y/N rispettivamente, se ne ho ancora necessità.

### Trigger eliminato

Adesso creare uno User non genera via mysql uno UserContact.
Serve farlo quando viene fatto user::create()

```sh
$ php artisan make:event UserEmailVerified

   INFO  Event [app/Events/UserEmailVerified.php] created successfully.  

$ php artisan make:listener UserContactBuilder

   INFO  Listener [app/Listeners/UserContactBuilder.php] created successfully.  
```

Il nome dell'evento è un participio passato, il nome dell'osservatore
è un soggetto + una azione.

Dentro </app/Http/Controllers/Auth/VerifyEmailController> viene "segnalato un evento"
e dentro il listener l'evento viene intercettato e il parametro usato per fare.

### Observer

Per le *tabelle siamesi* User e UserContact posso fare sw
quello che faccio in trigger con sql, ma con il vantaggio
che non scateno eventi a loop infinito: User Aggiorna UserContact
che aggiorna User Che aggiorna UserContact. No:
quando viene aggiornato User aggiorna userContact
ma quando viene aggiornato userContact aggiorna User senza scatenare
l'evento User update() che aggiorna UserContacts.

[Chiedi a Gemini 2](./2026-02-12-gemini-say-2.md)

### Countries si espande

GEmini mi ha convinto che la tabella Country può
portare qualcosa in più.
Quindi al suo id alpha-3 e al country e al flag_code
che è l'emoji della bandiera, si sono aggiunti
la colonna lang, la colonna locale, la colonna
international phone prefix. Anche se, a farla semplice,
locale ce ne sono più di uno per molti
paesi, tipo svizzera che non si parla lo svizzero.

```sh
$ php artisan make:model Country -a

   ERROR  Model already exists.  

 ┌ Do you want to generate additional components for the model? ┐
 │ Yes                                                          │
 └──────────────────────────────────────────────────────────────┘

   ERROR  Factory already exists.  

   INFO  Migration [database/migrations/2026_02_12_224649_create_countries_table.php] created successfully.  

   ERROR  Seeder already exists.  

   INFO  Request [app/Http/Requests/StoreCountryRequest.php] created successfully.  

   INFO  Request [app/Http/Requests/UpdateCountryRequest.php] created successfully.  

   INFO  Controller [app/Http/Controllers/CountryController.php] created successfully.  

   INFO  Policy [app/Policies/CountryPolicy.php] created successfully.  
```

la migration la cancello che è di fatto "in più".

## No more

Quello che sarà il primo refactor è la funzione user_contacts.id by user_contacts.user_id.  
Per effetto del nuovo Observer ssi può gestire la
coppia di tabelle siamesi (parzialmente legate)
che condividono la stessa chiave id in un rapporto 1:0/1.

Si può pensare anzi che la verifica email si conclusa con
l'apertura della scheda di modifica di user_contacts
al posto di atterrare nella dashboard. Per la dashboard c'è tempo.

Devo andare a caccia di tutti gli user_id e quelli di users passarli a user_contacts.id
E anche i legami nelle foreign delle migration on('users'), tutti no ma tanti sì,
girarli a on('user_contacts').
