# 10/02/2026

[⏪ ieri](./2026-02-09_IT.md) | [index](../index.md) | [domani ⏩](./2026-02-11_IT.md)  
[Docs](/resources/docs/1.0/overview.md)

## Terminato il round di ricostruzione delle migration

Gemini mi ha detto di creare mysql schema e quindi posso
cancellare le migration perché o queste o quelle.  
Poi mi ha detto che quel consiglio era *scellerato*
perché le migration sono pane per imparare.

Naturalmente non potevo esimermi dallo **scassare** o detto
in bella maniera, di *perfezionare* lo schema del database.
Perfino una tabella di lookup sparisce per fare porto a una
colonna boolean(). Il campo *Quota partecipazione pagata*
è o non è pagata. Non ci sono terze vie o valori.
L'alternativa sarebbe: registrare il pagamento se
con bank transfer / bonifico, se con paypal o altre
piattaforme di pagamento e l'id del bonifico o del pagamento
e già che ci siamo il suo importo. Contabilità.  
Si può fare.

Le tabelle sono state riviste e messe in ordine di precedenza,  
le tabelle che abbisognano di qualche altra tabella già
creata e presente per le foreign key sono create dopo.
Aiuta la data e ora del file a fare l'ordine di esecuzione.

## Scasso subito o faccio un giro d'ispezione?

Dove eravamo rimasti? Ai test. Per andare a fare i test
devo rigenerare il database dalle migration, in modo che
si possa costruire e ricostruire.  
Prima passo a yapcp4, vediamo se regge il colpo.

Si sono completati i migration in yapcp4 (che si chiama yapcp4
perché si appoggia a livewire 4 ma pare sia piuttosto immaturo)
e ho ribaltato in yapcp i migration ma non ho ancora scatenato
la resetfinedimondo.

###  Limitare i danni

* Verificare che tutti i modelli che si basano su uuid
come chiave primaria abbiano nel Model use `HasUuids;`.
* Verificare che per i migration che hanno foreign keys
ci siano le funzioni belongsTo e/o HasOne HasMany
* Rigenerare il Model con iol flag -a e cancellare
la migration (che di fatto diventa un inutile doppione)
* verificare i factory e i seeder (per esempio in quello
del Model Country ho previsto una colonna che contiene
il language code, usato in futuro per i18n)
* Riprendere l'elenco della spesa: chi fa cosa. Registrarsi,
collegarsi (login), visionare la propria dashboard,
modificare le schede user_contacts, visionare l'elenco
dei concorsi, caricare immagini, iscriversi ai concorsi,
visionare lo stato delle iscrizioni e partecipazioni.

### Non sono ancora stati realizzati

* la pagina in cui si vedono tutti i concorsi
eccetto quelli della organizzazione a cui si appartiene.
* la pagina dei risultati e delle partecipazioni.
* la pagina che per ogni immagine ti dice la storia
delle partecipazioni a concorsi precedenti.
* Se una immagine è stata rimbalzata e si trova in
contest-waiting.

## Mattoncini

Alcune parti della piattaforma sono ancora piuttosto
procedurali e questo non è bene o male, è una scelta.  
Piuttosto, se c'è veramente un sistema per fare meglio,
va imparato e applicato. Per esempio la scrittura
di un record user_contacts quando viene creato un record users
è stata delegata al gestore archivio mysql con un trigger.
Efficace, semplice, pratico. L'alternativa, più accademica
e chiara, è svincolarsi dal legame trigger e realizzare
in codice la scrittura del record-siamese all'interno
del codice, e questo si può fare aggiungendo codice
sotto la User::create() ma anche sfruttando il sistema
di notifica. Quando viene avviato un evento "creato utente"
con i dati dello users appena inseriti che partono
come messaggio in bottiglia, un secondo ascoltatore
può intercettare il carico e con quello scrivere il record
nella tabella user_contacts. Un terzo ascoltatore
può incrementare una tabella di contatori da esporre
nel cruscotto landpage e via così.

### Sicuri che vada tutto bene?

Se nel complesso procedurale qualcosa va bene e qualcosa no,
si resta appesi in una sorta di guado. Però l'errore
si manifesta. Quando invece l'attività viene fatta da
un componente nascosto, da un ascoltatore, come arrivano i messaggi
di buon fine o di errore all'utente? notifiche con campanella?

## da 0 test a CRUD Test in 18 minuti

<https://youtu.be/HDHaXyPs8MU?si=bSYFawkSWi4DVBjM>

## quali permessi hai?

* sei un partecipante
* sei membro di una organizzazione
* fai parte di una giuria
* fai parte di una federazione e devi controllare ogni cosa
* sei amministratore e devi occuparti di gestire
  le definizioni delle federazioni, di fare i backup
  e le restore e le cancellazioni
