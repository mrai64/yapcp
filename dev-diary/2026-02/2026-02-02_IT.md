# 02/02/2026

[index](../index.md) | [ieri](./2026-02-01_IT.md)  
[Docs](/resources/docs/1.0/overview.md)

## phpdoc: @property

Sulla scorta di un video da youtube
[Raccomandazioni Laravel](https://youtu.be/QFh21mFLH8I?si=2fkBVtXzafRngzZz)
decido di adottare le `@property` nella testata dei modelli.

Quando ci saranno aggiornamenti al database e quindi ai Model
servirà rilanciare lo script usando

```sh
php artisan ide-helper:models --write
```

Che usa l package Laravel Ide Helper

```sh
composer require --dev barryvdh/laravel-ide-helper
```

## Scoperto HasUuid

Come ci sono le indicazioni use HasFactory / use SoftDelete, esiste anche
la use HasUUid, che "si occupa" di fare la creazione di un
id stringa non incrementale, che contiene un uuid versione 7.
Questa versione della definizione di campo uuid occupa sempre 36 caratteri
utf8mb4, ma non è più necessario definire id stringa, non incrementabile ed
è una comodità adesso che le ho allineate su tutti i modelli andare
a toglierle su tutti i modelli che li usano,
non solo: si possono compattare in 36 caratteri 36. Con la codifica ASCII.

## La mia collection di farfalle

Questione efficienza: la collection utf8mb4 va bene
per memorizzare stringhe, comprese le bandiere definite in unicode
per tutti i paesi del mondo e qualcosa in più (bandiera bianca,
nazioni unite ecc.) ma per memorizzare indici con le chiavi uuid
conviene passarle alla collection ASCII. Occuperanno SOLO 36 byte al posto
di 144byte perché utf8mb4 usa 4byte per ogni char, 36 che potrebbero
diventare anche 32 se si levano i trattini.

Usare uuid v7 consente di legare il codice al timestamp
consentendo di ordinarli in sequenza cronologica pur mantenendo
la loro caratteristica di unicità.

Volendo invece usare il "vecchio" uuid versione 4 si avranno
codici veramente causali e che si distribuiscono qua e la.

---

Cose da fare:

Per mettere la collation ASCII in mysql devo prima smontare le relazioni
a livello di mysql, poi fare il cambio di formato, poi fare la ricostruzione
delle relazioni.

1. Contest
    1. Va smontata la relazione con countries.id
    1. Va smontata la relazione con la tabella timezones
    1. Va convertita la colonna id in ASCII
    1. Va convertita la colonna country_id in ASCII
    1. Va convertita la colonna timezones_id in ASCII
    1. Va rimessa la relazione con la tabella countries
    1. Va rimessa la relazione con la tabella timezones

1. ContestAward
    1. va smontata la relazione con contests.id
    1. va smontata la relazione con contest_sections.id (se c'è)
    1. va modificata la colonna id in ASCII
    1. va modificata la colonna contest_id in ASCII
    1. va modificata la colonna section_id in ASCII
    1. va rimessa la relazione con contests.id
    1. va rimessa la relazione con contest_sections.id (aggiungere)
1. ContestJury
    1. va smontata la relazione con contest_section_id
    1. va smontata la relazione con user_contacts.user_id
    1. va modificata la colonna id in ASCII
    1. va modificata la colonna section_id in ASCII
    1. va modificata la colonna user_contact_id in ASCII
    1. va rimessa la relazione con user_contacts.user_id
    1. va rimessa la relazione con contest_sections.id
1. ContestParticipant
    1. va smontata la relazione con contests.id
    1. va smontata la relazione con user_contacts.user_id
    1. va modificata la colonna id in ASCII
    1. va modificata la colonna contest_id in ASCII
    1. va modificata la colonna user_id in ASCII
    1. va rimessa la relazione con contests.id
1. ContestSection
    1. va smontata la relazione con contests.id
    1. va modificata la colonna id in ASCII
    1. va modificata la colonna contest_id in ASCII
    1. va rimessa la relazione con contests.id
1. ContestsVoteRuleSet  
Non c'è niente da fare
1. ContestVote
    1. va smontata la relazione con contests.id
    1. va smontata la relazione con contest_sections.id
    1. va smontata la relazione con works.id
    1. va smontata la relazione con user_contacts.id
    1. va modificata la colonna id in ASCII
    1. va modificata la colonna juror_user_id ASCII
    1. va modificata la colonna work_id ASCII
    1. va modificata la colonna section_id ASCII
    1. va modificata la colonna contest_id ASCII
    1. va rimessa la relazione con contests.id
    1. va rimessa la relazione con contest_sections.id
    1. va rimessa la relazione con works.id
    1. va rimessa la relazione con user_contacts.id
1. ContestWaiting
    1. va smontata la relazione con contests.id
    1. va smontata la relazione con contest_sections.id
    1. va smontata la relazione con works.id
    1. va smontata la relazione con user_contacts.user_id partecipante
    1. va smontata la relazione con user_contacts.user_id giurato
    1. va modificata la colonna id
    1. va modificata la colonna contest_id
    1. va modificata la colonna section_id
    1. va modificata la colonna work_id
    1. va modificata la colonna participant_user_id
    1. va modificata la colonna organization_user_id
    1. va rifatta la relazione con contests.id
    1. va rifatta la relazione con contest_sections.id
    1. va rifatta la relazione con works.id
    1. va rifatta la relazione con user_contacts.user_id partecipante
    1. va rifatta la relazione con user_contacts.user_id giurato
1. ContestWork
    1. va smontata la relazione con contests.id
    1. va smontata la relazione con contest_sections.id
    1. va smontata la relazione con countries.id
    1. va smontata la relazione con user_contacts.user_id
    1. va smontata la relazione con works.id
    1. va modificata la colonna id
    1. va modificata la colonna contest_id
    1. va modificata la colonna section_id
    1. va modificata la colonna country_id
    1. va modificata la colonna user_id
    1. va modificata la colonna work_id
    1. va rifatta la relazione con contests.id
    1. va rifatta la relazione con contest_sections.id
    1. va rifatta la relazione con countries.id
    1. va rifatta la relazione con user_contacts.user_id
    1. va rifatta la relazione con works.id

1. Country
    1. va modificata la colonna id

1. Federation
1. FederationMore
1. FederationSection
1. LangList
1. Organization
1. Region
1. Timezone
1. TimezonesList
1. User
1. UserContact
1. UserContactMore
1. UserRole
1. UserRolesRoleSet
1. Work
1. WorkValidation

[Chiedi a Gemini](2026-02-02-geminy-say-1.md)

Alla fine **viva la scorciatoia**, metto in mezzo Sequel Ace e
faccio il cambio in applicazione. Perché a bloccare
l'operazione sono i legami del campo con le tabelle
anche se sono definiti nelle tabelle fuori.

Cambiare tutti gli uuid in ascii/ascii_general_ci

## *.user_id che è user_contact.user_id

Ci sarebbe da cambiare un paio di cose no da poco:

1. Cambiare user_contacts.user_id nella primary key
della tabella user_contacts
1. Togliere user_contacts.id e rinominare user_contacts.user_id
come user_contacts.id
1. Cambiare tutti i rifermenti a users.id in user_contacts.id
in giro per la piattaforma.

Robetta da niente...

## Lista delle tabelle e delle relazioni

Tutte le tabelle hanno in comune rte campi di tipo
datetime che riguardano created_at, updated_at,
deleted_at. Questi hanno uso anche per backup
e rimozione. Anche le tabelle di lookup spiegate
più sotto di Timezone, di Country avranno i campi.

1. User  
  La tabella predefinita di laravel insieme a quelle di
  sistema, ma la versione base deve essere modificata
  passando per id uuid, per il softdelete.
  Tabella utenti con password.
  
2. Country  
  Tabella lookup, anche per questa niente id base
  ma un char(3) che rispecchia la codifica
  iso-3166 alpha 3, maiuscole. Il nome della
  nazione in inglese.
3. Organization  
  La tabella dei circoli organizzatori di concorsi
  anche questa con uuid come chiave
4. Federation  
  La tabella delle federazioni, gestita dagli admin
  da cui dipendono i concorsi con le loro regole,
  non tutte regole comuni. Perfino le verifiche
  di conformità delle opere possono variare
  sul concetto di bianconero o monocromatico, per esempio.
  Come Country ha uan chiave stringa, non la chiave base
  integer autoincrementale.
5. Contest  
  Una delle tabelle dedicate ai concorsi, in questa
  vengono riportati i dati base del concorso.  
  Attualmente i circuiti concorsi è previsto siano
  censiti nella stessa tabella concorsi, con cui
  condividono una parte di dati. Per esempio se tutti
  i concorsi in circuito condividono lo stesso calendario,
  i dati possono essere inseriti in un primo record
  e poi messi a disposizione dei concorsi singoli
  inseriti dopo.
6. Timezone  
  Tabella di lookup
  Per una piattaforma su internet le scadenze che dipendono
  dal fuso orario vanno gestite. Questa tabella
  elenca direttamente tutte le voci previste e gestite
  da php 8.5, per consentire la creazione di
  moduli e convalidare i dati.
  Sarebbe possibile dimetterla, per lasciare al php puro
  il compito di fornire i dati.
7. UserContact  
  Prima e principale tabella legata a User dal legame
  di e-mail, anche questa ha chiave basata su uuid
  e ricalca la rubrica, con tutti i riferimenti
  "comuni a tutti" i concorsi. Nome, cognome,
  email (condivisa dalla tabella User), indirizzo postale
  a cui mandare comunicazioni e premi
8. UserContactMore  
  Questa è la tabella dei dati che ogni federazione chiede
  "in più", ed è una tabella figlio con tabella padre
  quasi ovvio UserContact. id del record, id user contact,
  id federazione, nome del campo, valore del campo.
9. FederationMore  
  Questa è la tabella in cui sono elencati i "campi in più"
  che le federazioni chiedono e nell'elenco sono
  presenti: id Federazione, id/nome tabella,
  id/nome campo, etichetta, suggerimento,
  valore predefinito e stringa di validazione.  
10. UserWorks  
  Attualmente è la tabella Works, fa da deposito
  delle opere che partecipano ai concorsi. anche
  per questa tabella l'id è uuid, e contiene
  alcuni dati usati in tutti i concorsi.
11. UserWorkMore  
  Quasi tutti i concorsi hanno le stesse richieste,
  come un titolo dell'opera, ma questa tabella
  contiene i "dati in più" richiesti dalle federazioni
  per la partecipazione ai concorsi di loro patrocinio.
  uuid id record, uuid userWork, id federazione, nome campo
  e valore campo
12. UserRole  
  Questa tabella - sono esclusi gli admin - contiene
  per ogni userContact eventuali ruoli che svolge
  all'interno di organizzazioni, concorsi, federazioni.
  Fa da base per la definizione di cosa entra nella dashboard,
  per valore predefinito tutti sono concorrenti,
  ma qualcuno può essere giurato, per esempio, oppure
  far parte di una organizzazione che ha un concorso.
13. UserAdmin  
  Attualmente non realizzata.  
  La tabella degli admin, anche questa con id uuid
  e destinata solo agli admin.
14. FederationSection  
  Per la definizione dei concorsi le federazioni
  decidono di strutturare i concorsi con un numero
  limitato di temi e sezioni, quindi dovendo strutturare
  i concorsi a patrocinio sulla base delle regole
  stabilite le organizzazioni pescano da questa tabella
  i temi e sezioni.
15. FederationDistinction  
  Attualmente non realizzata  
  la tabella delle distinzioni serve per UserContact
  o userContactMore in cui agli autori è richiesto indicare
  eventuali onorificenze e distinzioni ricevute
  da parte delle federazioni. Per validare o 
  fornire alle schermate direttamente i valori corretti
  senza impazzire con le correzioni a posteriori.
16. ContestSection  
  Tabella figlio di Contest, questa tabella
  non necessariamente legata alla tabella FederationSection,
  elenca le sezioni e temi del concorso. La chiave
  anche in questo caso uuid, con contest id.
17. ContestJury  
  Abbinata a ogni contest section, è un elenco di giurati che
  compongono la giuria. id giuria uuid, id section, id concorso
  (anche se basta tecnicamente solo section id), uuid del giurato.
  Potrebbe ma non è la tabella UserRole. Valutare se usare
  la tabella userRole per questa funzione.
18. ContestAward  
  Questa tabella riporta l'elenco dei premi per ogni
  concorso, per ogni sezione e tema, fornendo con la chiave
  una sequenza ordinabile di premi. Per registrare i
  premi ci concorso viene omessa (default o nullificata)
  la sezione. Il circuito ha premi di circuito.
19. ContestWorks
  I lavori dei concorrenti registrati a partecipare ai concorsi,
  o ai circuiti. Perché chi partecipa a circuiti partecipa
  a tutti i concorsi del circuito.
  id uuid, id del concorso, id della sezione, id dell'opera
  da UserWork, comprensivo di esito del concorso (ammissione).
  La tabella contiene anche il percorso per l'immagine
  spostato e isolato dal deposito originario dell'autore in un folder
  o cartellina della sezione / concorso.
20. ContestWarning  
  Tabella in cui vengono messi da parte i lavori che a un
  controllo ispezione umano non risultano conformi e per ciò
  viene mandato un avviso all'autore che possa fare le sue
  eccezioni o la sostituisca con un'altra.
21. UserWorksValidated  
  Tabella che contiene, sulla base della ispezione visiva,
  le opere che hanno passato la verifica. id uuid, e
  rifermenti a id federazione, id sezione federazione
  (o id sezione concorso se questo non ha nessun sponsor)
  id del verificatore, dati di log per la verifica.

[*(segue)*](./2026-02-03_IT.md)