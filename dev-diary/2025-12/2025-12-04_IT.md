# Diario dello sviluppatore, data 4 dicembre 2025

* [index](../index.md) |
  [To Do List](../TDL.md) da svuotare e migrare in |
  [project](https://github.com/users/mrai64/projects/1) issue list

* [Route](/routes/web.php)

* [◀️ Diario di ieri](./2025-12-03_IT.md)

* run <http://yapcp.test/>
* [log](/storage/logs/laravel-2025-12-04.log) | ngnix log  `open ~/Library/Application\ Support/Herd/Log`

## Strumenti

Intanto ho risolto il problema della view, andando in mysql e facendo
la select sulla tabella contest, è andata. Per la view
l'errore è stato più parlante: L'utente specificato come defnied non esiste.
e quindo utente 'Sql1515403'@'localhost' non è 'Sql1515403'@'%'.

Creato e garantito.

```txt
mysql> select * from pcp_contests_view;
ERROR 1449 (HY000): The user specified as a definer ('Sql1515403'@'%') does not exist
mysql> create user 'Sql1515403'@'%' identified by '(...)';
Query OK, 0 rows affected, 1 warning (0,06 sec)

mysql> grant all privileges on pcpdb.* to 'Sql1515403'@'%';
Query OK, 0 rows affected (0,00 sec)

mysql> select * from pcp_contests_view;
+----------------------------------------------------------------------+-----------------------------------------------------------------------+---------------------+------------------------------------------------------------+-----------------+-----------------+-----------+--------------------------------------+--------------------------------------+--------------------------------------+--------------+
| contest_name                                                         | contest_local_name                                                    | day_2_closing       | organization_name                                          | first_name      | last_name       | role      | contest_id                           | organization_id                      | user_id                              | user_role_id |
+-----------------------------------------------
```

Risolto questo step come a sudoku pare che si sia sbloccato qualcosa
per coincidenza temporale anche sul fronte del Bad Gateway che adesso
è diventato timeout indicando anche in log che il component viene
chiamato, arriva a chiamare il rendere e poi va in timeout.

### Tabella countries completata e backup-pata

```sh
cd ~
cd Downloads
mysqldump --socket /tmp/mysql_3306.sock -u root --port=3306 pcpdb pcp_countries > pcp_countries.sql
```

Se si mette user Sql1515403 poi chiede la password, tenerla a portata di mano.

### Contest timeout

Ripartiamo dalla verifica.

1. Pagina inizio
1. Pagina dashboard utente
1. pagina dashboard organizzazione di cui fa parte utnte
1. link alla pagina di modifica scheda concorso  
timeout

Verificato in log [vedi](./2025-12-04%20laravel-2025-12-04.log). Funziona tutto e arriva al render().  
Quindi esce dal render e comincia a preparare la pagina, perché fa la richiesta della
funzione ContestSection::first_section_id, funzione che torna '' oppure un uuid.
E funziona, anche se in pratica potrei sostituirla con un count, ma invece no, devo usarla
per creare un link. Fin lì ci arriva.

[component](/app/Livewire/Contest/Modify.php)  
[blade](/resources/views/livewire/contest/modify.blade.php)  

Ficcando dei log anche nel blade vedo che arriva fino al 10. che precede lo spazio
del campo circuit_id e non espone quello dell'11. che lo segue.

Trovato anche questo: era il campo del suggerimento che usa una funzione `_()` e non `__()`.

Sistemato

### relazioni

Mancano alcune relazioni tra le tabelle dei contest, aggiunte.

## ARGHH!?!? per un commit di troppo

Situa: invece di fare il commit solo per un elemento, che è quello che avevo
intenzione di fare, si è fatto il commit di tutto, mescolando almeno
5 cose diverse e anche qualcosa che non va ancora committed.

Come risolvere:  
`git reset --soft HEAD~1`

E poi sfilo dal gruppo tutto o quello che serve.

## Dove eravamo rimasti?

Dalla dashboard dell'organizzazione sui concorsi da creare c'è
il link per creare il concorso, e poi andare a inserire i primi dati del concorso.
Quando il concorso è già creato, ho due strade:  

* andiamo a integrare la scheda di preparazione al concorso,
  con le altre info delle sezioni, dei giurati, dei premi
* andiamo a gestire il concorso già formato,  
  * andando a integrare l'elenco partecipanti che hanno già
    versato la quota di partecipazione,
  * andando a revisionare sia in automatico che in manuale
    le immagini partecipanti;
  * andando a verificare che tutti i giurati abbiano espresso il loro voto
    e identificando eventualmente una fascia di voto che richiede
    la spartizione tra IN e OUT
  * andando a stilare la classifica sezione per sezione delle opere ammesse

E non è finita qui:  
dopo la definizione delle opere ammesse si deve procedere,
sezione per sezione, a mettere in ordine manuale le opere che vanno a premio
abbinando ogni lavoro con il rispettivo premio o menzione che sono estratti
dalla tabella contest_awards.
Dopo l'ultima sezione ci saranno gli eventuali (ma ci sono sempre)
premi extra-sezione che saranno p.es. "miglior autore del concorso".
Idem per i premi (solo extra-sezione) che saranno assegnati ai circuiti.

Poi segue la generazione dei verbali e ci sarà il fermo per revisione
e firma del verbale da parte dei giurati, che si potrà fare inviando
copia del verbale a ciascun giurato per stampa, firma, scansione, inoltro.

## Adesso

* Riempito il concorso di concorrenti, con il seeder, e di voti, con il seeder,
serve attribuire a tutte le sezioni un gruppo di foto ammesse
e passare ai pannelli di assegnazione premi per sezione e al pannello
di assegnazione premi per la sezione "concorso".
Questo comporta la creazione di un "temporaneo"
tabellone di ammessi con sequenza, in cui si deve tenere anche conto
di una eventuale esclusione dai premi di un secondo lavoro
di un autore. Può essere normale che per un fotografo
bravo ci siano tra gli ammessi due o più lavori, anche tutti i proposti.

La tabella dei lavori ammessi però richiede una cosa:
di essere completa, senza paginazioni.
Oppure si da facoltà alla giuria riunita,
anche online, di decidere i premi e si lascia
all'organizzatore identificare e assegnare i premi
alle opere, alla presenza della giuria.  
Devono essere presenti:

* sequenza - abbinata al premio
* id opera
* miniatura con link a pieno schermo (versione concorso)
* nome fake dell'autore, assegnato al momento
