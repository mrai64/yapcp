# Gemini say del 19 dic 2025

## Domanda

Per un progetto laravel sto usando il generatore di pdf si spatie, e vorrei utilizzare dei google fonts che uso nelle view ma devo incorporarli nella view che genera il pdf, in particolare per avere un font narrow come yanone kaffesatz

## Risposta

√à un problema molto comune quando si generano PDF tramite strumenti basati su browser come **Spatie's `laravel-pdf**` (che usa Browsershot/Puppeteer). Poich√© il processo di generazione del PDF √® "headless" (senza interfaccia grafica) e spesso non ha accesso diretto alle risorse esterne come i Google Fonts su CDN, o ai file locali se non configurato correttamente, i font non vengono caricati.

La soluzione pi√π affidabile per incorporare un font specifico come **Yanone Kaffeesatz** √® quella di **scaricare il file del font e incorporarlo direttamente nel CSS della view del PDF**, possibilmente in formato **Base64** o assicurandosi che il percorso locale sia accessibile a Browsershot.

Ecco due metodi che puoi seguire:

### Metodo 1: Usare il pacchetto `spatie/laravel-google-fonts` (Consigliato per la gestione)

Spatie fornisce un pacchetto dedicato per gestire i Google Fonts localmente, il che √® perfetto per il tuo caso d'uso con la generazione di PDF. Questo pacchetto scarica i font e li serve localmente.

1. **Installa il pacchetto:**

```bash
composer require spatie/laravel-google-fonts

```

1. **Pubblica il file di configurazione:**

```bash
php artisan vendor:publish --tag=google-fonts-config

```

1. **Configura il font in `config/google-fonts.php`:**
Aggiungi l'URL del font Google per Yanone Kaffeesatz. Assicurati di specificare gli stili e i pesi che ti servono (ad esempio, Regular 400 e Light 300).

```php
// config/google-fonts.php
return [
    'fonts' => [
        'yanone' => 'https://fonts.googleapis.com/css2?family=Yanone+Kaffeesatz:wght@300;400;700&display=swap',
    ],
    // ... altre opzioni
];

```

1. **Scarica e cache i font:**
Esegui il comando per scaricare e memorizzare i file dei font localmente.

```bash
php artisan google-fonts:fetch

```

1. **Usa il font nella view del PDF:**
Nella tua view Blade che genera il PDF, usa la direttiva Blade `@googlefonts('yanone')` (se hai usato la chiave `yanone` nel config) per includere il CSS con il font incorporato, che ora punter√† ai file locali.

```blade
<head>
    <style>
        @googlefonts('yanone')

        /* Applica il font */
        .narrow-font {
            font-family: 'Yanone Kaffeesatz', sans-serif;
            /* Aggiungi altri stili se necessario, ad es. font-weight: 400; */
        }
    </style>
</head>
<body>
    <h1 class="narrow-font">Il mio testo con Yanone Kaffeesatz</h1>
    </body>

```

### Metodo 2: Incorporare il font in Base64 (Ideale se non vuoi installare un altro pacchetto)

Questo metodo √® la garanzia maggiore che il font sia disponibile per Browsershot, poich√© il font √® codificato direttamente nel tuo CSS e non richiede richieste HTTP aggiuntive.

1. **Scarica il file TTF o WOFF2 di Yanone Kaffeesatz.**
Puoi scaricarlo direttamente da Google Fonts o da siti come Google Fonts Helper, assicurandoti di ottenere il formato **`.ttf`** o **`.woff2`** (WOFF2 √® pi√π moderno e leggero).
2. **Converti il file del font in Base64.**
Utilizza uno strumento online (cerca "font to base64 converter") per convertire il file del font (`.ttf` o `.woff2`) in una stringa Base64.
3. **Aggiungi il CSS Base64 alla tua view del PDF:**
Nella sezione `<style>` della tua view che genera il PDF, aggiungi la dichiarazione `@font-face` usando la stringa Base64 come sorgente.

```blade
<head>
    <style>
        @font-face {
            font-family: 'Yanone Kaffeesatz Narrow';
            /* **Incolla qui la stringa Base64** */
            src: url('data:font/ttf;charset=utf-8;base64, ...TUA_STRINGA_BASE64_MOLTO_LUNGA...') format('truetype'); 
            font-weight: normal; 
            font-style: normal;
        }

        .narrow-font {
            font-family: 'Yanone Kaffeesatz Narrow', sans-serif;
        }
    </style>
</head>
<body>
    <h1 class="narrow-font">Il mio testo con Yanone Kaffeesatz</h1>
    </body>

```

### Suggerimenti Aggiuntivi

* **Problemi di Caricamento Rete:** Se non usi il metodo Base64, e Browsershot fallisce a caricare il font dalla CDN di Google (o da un percorso locale HTTP), puoi provare a disabilitare temporaneamente la sicurezza web di Browsershot (solo se strettamente necessario e consapevole dei rischi, come suggerito in alcuni thread):

```php
use Spatie\Browsershot\Browsershot;
use Spatie\LaravelPdf\Facades\Pdf;

Pdf::view('pdf.view')
    ->withBrowsershot(function (Browsershot $browsershot) {
        // Usa solo se i font NON vengono caricati dal metodo locale (1) o Base64 (2)
        $browsershot->setOption('args', ['--disable-web-security']); 
    })
    ->save('documento.pdf');

```

* **Percorsi Locali (Senza Base64):** Se preferisci non usare Base64, devi assicurarti che il percorso del font nella direttiva `@font-face` sia un **URL HTTP accessibile** (e non un percorso di file assoluto sul server) affinch√© Browsershot possa caricarlo. Ad esempio:

```css
src: url("{{ asset('fonts/YanoneKaffeesatz-Regular.ttf') }}") format("truetype");

```

Quale metodo preferisci esplorare per primo? Posso aiutarti a trovare la stringa Base64 per il font o darti maggiori dettagli sulla configurazione del pacchetto Spatie.

----

Capisco, evitare il Base64 mantiene il CSS pi√π pulito e leggibile. Usare un percorso locale √® un'ottima soluzione, ma richiede un piccolo accorgimento fondamentale: **Browsershot (che √® headless) deve essere in grado di raggiungere il file del font tramite un URL web, non un percorso di file sul tuo server.**

Ecco la procedura passo-passo per incorporare **Yanone Kaffeesatz** usando i percorsi locali, rendendo i font accessibili a Spatie PDF/Browsershot.

### üìú Procedura per Font Locali (Senza Base64)

#### 1. Scarica e Colloca il Font

1. **Scarica il Font:** Vai su Google Fonts e scarica la famiglia **Yanone Kaffeesatz**. Estrai il file zip e trova i file `.ttf` (TrueType Font) che ti servono (ad esempio, `YanoneKaffeesatz-Regular.ttf`, `YanoneKaffeesatz-Light.ttf`, ecc.).
2. **Crea la Cartella:** Crea una cartella per i tuoi font pubblici. La convenzione standard √®:
```
public/fonts/

```


3. **Colloca i File:** Copia i file `.ttf` di Yanone Kaffeesatz nella cartella `public/fonts/`.

#### 2. Crea il File CSS

Il modo migliore √® creare un file CSS separato per la stampa/PDF, in modo che sia facile da includere e gestire.

1. **Crea il File CSS:** Crea un file nella tua cartella pubblica, ad esempio:
```
public/css/pdf_fonts.css

```


2. **Dichiarazione `@font-face`:** Nel file `pdf_fonts.css`, dichiara il font per ogni peso che intendi usare. √à **cruciale** usare la funzione `asset()` per generare URL completi se usi Browsershot che naviga su un dominio come `localhost` o un URL di sviluppo.
> **Attenzione:** Dato che questo √® un file CSS statico e non un file Blade, **non puoi** usare la funzione `asset()` direttamente. Dovrai usare un percorso relativo all'URL base del tuo progetto.


**Esempio per `public/css/pdf_fonts.css`:**
```css
@font-face {
    font-family: 'Yanone Kaffeesatz';
    src: url('/fonts/YanoneKaffeesatz-Light.ttf') format('truetype');
    font-weight: 300; /* Light */
    font-style: normal;
}

@font-face {
    font-family: 'Yanone Kaffeesatz';
    src: url('/fonts/YanoneKaffeesatz-Regular.ttf') format('truetype');
    font-weight: 400; /* Regular */
    font-style: normal;
}

/* Aggiungi altri pesi (es. Bold 700) se necessario */

```


*Il percorso `/fonts/...` √® un percorso assoluto che parte dalla root pubblica del tuo server.*

#### 3. Includi il CSS nella View del PDF

Nella tua view Blade che genera il PDF, includi il file CSS come faresti normalmente.

```blade
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Documento PDF</title>
    
    <link href="{{ asset('css/pdf_fonts.css') }}" rel="stylesheet" type="text/css">

    <style>
        /* Applica il font ai selettori desiderati */
        body {
            font-family: 'Yanone Kaffeesatz', sans-serif;
            font-weight: 400; /* Usa il peso Regular di default */
        }
        .narrow-header {
            font-weight: 300; /* Usa il peso Light */
        }
    </style>
</head>
<body>
    <h1 class="narrow-header">Intestazione con font Light</h1>
    <p>Testo del corpo con font Regular.</p>
</body>
</html>

```

#### 4. Genera il PDF

Quando generi il PDF, Browsershot caricher√† la view, vedr√† il tag `<link>`, e tenter√† di accedere a `http://localhost/css/pdf_fonts.css` e successivamente ai font in `http://localhost/fonts/YanoneKaffeesatz-Regular.ttf`.

```php
use Spatie\LaravelPdf\Facades\Pdf;

// Assicurati che il tuo server di sviluppo (es. Laravel Valet, Herd, o artisan serve) sia attivo!
Pdf::view('pdf.documento')
    ->format('A4')
    ->save('documento_con_yanone.pdf');

```

**‚ö†Ô∏è Punti Critici da Verificare:**

1. **URL Accessibile:** Quando Browsershot accede alla tua view, deve essere in grado di risolvere l'URL del font. Se usi `artisan serve`, Browsershot acceder√† a `http://127.0.0.1:8000`. Assicurati che l'URL generato da `asset('fonts/...')` sia corretto per l'ambiente in cui Browsershot viene eseguito.
2. **Tipo MIME:** Se Browsershot ha problemi a caricare i font, a volte √® dovuto a una configurazione del server web che non riconosce i tipi MIME per i file `.ttf`. Se il problema persiste, potresti dover aggiungere al tuo server web (Nginx/Apache) o al file `.htaccess` la dichiarazione: `AddType application/x-font-ttf .ttf`.
3. **Cache:** A volte Puppeteer/Browsershot ha problemi di caching. Un piccolo trucco √® forzare una versione come: `src: url('/fonts/YanoneKaffeesatz-Regular.ttf?v=1') format('truetype');`

Se riscontri problemi, √® quasi sempre legato al fatto che Browsershot non √® riuscito a scaricare il file del font. In tal caso, il **Metodo 1 (Spatie Google Fonts)** o il **Metodo 2 (Base64)** diventano le alternative pi√π affidabili.

Hai bisogno di aiuto per individuare i percorsi esatti dei font una volta scaricati?
