# Diario dello sviluppatore, data 15 dicembre 2025

* [index](../index.md) |
  [To Do List](../TDL.md) da svuotare e migrare in |
  [project](https://github.com/users/mrai64/projects/1) issue list

* [Route](/routes/web.php)

* [◀️ Diario di ieri](./2025-12-14_IT.md)

* run <http://yapcp.test/>
* [log](/storage/logs/laravel-2025-12-15.log) | ngnix log  `open ~/Library/Application\ Support/Herd/Log`

## Pagina Assegnazione premi per concorso

Da collaudare l'assegnazione dei premi con campo testo e con selezione select.

[9° Tonino di Venanzio](https://yapcp.test/organization/award-assign/contest/e8ac5674-c3d1-4afa-adaf-a7d5ed82d292)

Continuo ad avere problemi con i dati in transito, di fatto non è disponibile
il codice dle premio che ho inserito nel modulo
form come input hidden, e inoltre quando modifico
un calore (già visto) si attivano entrambi i moduli
in parallelo. Quindi la fnd per aggiornare il campo
non va e faccio update sul null.

* componente e blade per il modulo, input: contest_id+award_code
* regola di validazione "complessa" per la verifica della presenza dello user_id
  ma per il set ridotto dei partecipanti a *quel* contest_id, non nella tabella in generale.

Battezzo il modulo: ContestAssign no già dato, con SectionAssign. ContestAwardAssign, per ora.

Regola per la verifica dello user_id partecipante al concorso,
come per un caso precedente devo forzare l'uso di un campo
session per rendere disponibili due dati nella verifica di due campi
in sequenza. La sequenza deve prevedere prima il campo
contest_id per metterlo in session, quindi il campo winner_user_id
per consentire la reale verifica solo di questo.

```sh
$ php artisan make:rule UserInContest

   INFO  Rule [app/Rules/UserInContest.php] created successfully.  
```

Non esce l'elenco dei vincitori, primo perché non tengono conto che
ci sia un winner_work_id ma anche un winner_user_id oltre a
winner_name. Ma se mi esce user_id, poi per i nomi?

```sql
select 
  coalesce(pcp_user_contacts.country_id, ''),
  coalesce(pcp_user_contacts.last_name, ''),
  coalesce(pcp_user_contacts.first_name, ''),
  pcp_contest_awards.*
  from pcp_contest_awards
  left join `pcp_user_contacts`
    on (pcp_user_contacts.user_id = pcp_contest_awards.winner_user_id)
where pcp_contest_awards.section_id IS NULL
and pcp_contest_awards.contest_id = 'e8ac5674-c3d1-4afa-adaf-a7d5ed82d292'
order by pcp_contest_awards.award_code;
```

Ci aggiungo un altro campo del flag_code dalla tabella countries.

Funziona. **commit**
