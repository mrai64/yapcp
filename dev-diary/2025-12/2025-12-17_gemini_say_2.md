This is a fantastic follow-up error! It confirms that your previous fix (assuming you tried to install `puppeteer`) was necessary, but the system is still failing to find the Node.js module. This points to a **path or permissions issue** in your local development environment (Herd/Valet on macOS).

The core problem remains:

> **Error: Cannot find module 'puppeteer'**

However, the reason *why* it can't find it has shifted. The system is trying to use the **global** Node path (`NODE_PATH=`npm root -g``) but seems to be missing the local project's `node_modules`.

---

## ðŸš€ Solution: Local Installation and Path Configuration

The best practice for `spatie/browsershot` on a local development environment like Herd/Valet is to install the Node dependencies **locally in your project** and then explicitly tell Browsershot where to look for them.

### Step 1: Ensure Local Installation of `puppeteer`

If you haven't already, run the installation command in your project root (`/Users/massimorainato/Sites/yapcp`):

```bash
npm install puppeteer

```

This creates the `node_modules/` folder with `puppeteer` inside it.

### Step 2: Configure Browsershot to Use Local Dependencies

In your Laravel application's PDF generation code, you need to explicitly tell Browsershot to use the `node_modules` folder located in your project root.

The most reliable place to do this is in a Service Provider, but you can also do it in the Livewire component if you prefer a quick test.

#### Option A: Project Root Installation (Recommended)

Modify your PDF generation code in `app/Livewire/Organization/Minute/Draft.php` (around line 188, where the error is triggered) to explicitly point to your project's `node_modules` directory:

```php
use Spatie\Browsershot\Browsershot;
use Spatie\LaravelPdf\Facades\Pdf;

// ... inside your PDF generation method ...

$pdf = Pdf::view('your.view', $data)
    ->withBrowsershot(function (Browsershot $browsershot) {
        // --- ADD THIS LINE ---
        $browsershot->setNodeModulePath(base_path('node_modules'));
        // ---------------------
        
        // Other existing configurations:
        $browsershot->format('A4')
                    ->landscape()
                    ->setOption('args', ['--no-sandbox']); // Keep this if you need it
    })
    ->download('jury-minute.pdf');

```

The `base_path('node_modules')` will correctly resolve to `/Users/massimorainato/Sites/yapcp/node_modules`, which is where `puppeteer` now lives.

#### Option B: Global Path Configuration (If Option A Fails)

If you installed `puppeteer` globally (using `npm install -g puppeteer`), you might need to find the correct global path and manually pass it as an argument.

1. **Find Global Path:** Run `npm root -g` in your terminal. It might output something like `/usr/local/lib/node_modules`.
2. **Configure:** In your code, set the absolute path:

```php
// Replace /path/to/global/node_modules with the output of npm root -g
$browsershot->setNodeModulePath('/usr/local/lib/node_modules'); 

```

**I strongly recommend trying Option A first, as it keeps your dependencies local to the project.**

---

### Why this happens on Mac/Valet/Herd

When PHP executes the `node` command via the Symfony Process component, it doesn't always inherit the user's full environment path (`$PATH`) correctly. This means the Node script (`browser.cjs`) doesn't know where to look for its dependencies (`puppeteer`). By using `setNodeModulePath(base_path('node_modules'))`, you bypass this environmental path issue by giving Browsershot the explicit, absolute path to the required Node modules.

Let me know if setting the node module path resolves the issue!
