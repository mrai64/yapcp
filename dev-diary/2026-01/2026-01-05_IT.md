# Diario dello sviluppatore, data 5 gennaio 2026

* [index](../index.md) |
  [project](https://github.com/users/mrai64/projects/1/views/1?filterQuery=is%3Aopen&sortedBy%5Bdirection%5D=asc&sortedBy%5BcolumnId%5D=Title) issue list |
  [To Do List](../TDL.md) svuotato  

* [Route](/routes/web.php)

* [◀️ Diario di ieri](./2026-01-04_IT.md)

* run <http://yapcp.test/>
* User Doc <http://yapcp.test/docs/1.0/> [index](/resources/docs/1.0/index.md)
* [log](/storage/logs/laravel-2026-01-05.log)  | ngnix log  `open ~/Library/Application\ Support/Herd/Log`  `open ./storage/logs/`

## Today Do list

* Completare popolamento excel

## *Dammi i dati* user->contact-> vs. *fammi la query* user->contact()->

DA [un tutorial](https://youtu.be/MbksBczShcA?si=EPltd_1urmStSFqj) di 4 anni fa scopro accidentalmente che le relazioni
hanno il potere di fare da segnaposto. Invece di creare complesse query con left join, è già implicito nelle hasOne, hasMany, belongsTo e belongsToMany, ma non solo: se le usi "come al solito" `$contest_participants->user_contacts` vengono eseguite e da  lì in avanti hai `i dati fatti`, se le metti come funzioni da chiamare `$contest_participants->user_contacts()` da lì n avanti hai `la query fatta`, che si puà integrare con altri filtri ed ordinamenti. **E questo nei tutorial non c'è**

## Excel vuoto

E a ragione, i dati che espongo dei participants sono nella user_contacts e contest_participants ha "solo" uno user_id,
quindi la lista devo costruirla come array in cui a loop inserisco i dati e già che ci sono pesco anche
le sezioni del concorso e le ammissioni.
BelongsToTrough [vedi tutorial](https://youtu.be/5s-_SnVl-1g?si=0xGO4794aFdYoAxj).

## ❓ Patrocinio? di chi?

Nella tabella user_contacts_more indico il codice federazione come fk,
nel concorso ho un campo con **un elenco** di codici patrocinio che ragionevolmente
posso indicare come FEDERATION_ID:PATRONAGE_CODE, ovvero FIAF:2026M1 FIAP:2026/123,
quindi per la scrittura del foglio excel dall'elenco dei patrocini
separo (separatore: ' ' spazio) l'elenco dei patrocini e da questi separo K:V
(separatore: ':') le'elenco delle federazioni e poi passo a fare il foglio excel 
per ciascuna federazione come lo vuole.

Relazioni che possono velocizzare la query

* concorso > sezioni
* concorso > partecipanti > user_contacts
* concorso > partecipanti > sezioni > lavori
* query dei lavori ordinati per user_id, e per sezione e per sequenza  
  Contatore dei lavori presenti contatore dei lavori ammessi

Devo rovesciare la query, se parti dai lavori, concorrente per concorrente,
creo prima la tabella delle sezioni, poi in base allo user_id
aggiungo i dati delle persone e quindi per ultimo i dati del concorso
sono sempre una gran pacca di dati.

Mi pare il caso di [chiedere](./2026-01-05_gemini_say_1.md).

In questo caso viene ignorata la presenza delle sezioni,
però tra qualche migliaio di query e una mezza dozzina,
sia conveniente fare una query per ogni sezione e
memorizzarle in array, per poi avere un array di partecipanti
tutti coordinati in base allo user_id.
